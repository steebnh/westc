{"version":3,"sources":["../src/ctrl.js"],"names":["SEL_DISABLE_DOWNLOAD_CSV","replace","DEFAULT_PANEL_SETTINGS","html","css","canDownloadDatasets","emIsContentHeight","normalizeHasher","hasher","hasherType","row","JSON","stringify","map","item","VueHtmlPanelCtrl","$scope","$injector","$rootScope","_","defaultsDeep","panel","events","on","onInitEditMode","bind","onDataReceived","onViewModeChanged","onInitPanelActions","actions","tablesSubmenu","panelElement","find","toArray","reduce","carry","table","index","jQuery","is","push","text","getAttribute","icon","click","length","apply","divider","role","concat","datasetsSubmenu","dataset","data","raw","type","columns","refId","path","addEditorTab","logVueScope","datasetIndex","columnNames","rows","JS","dom","href","encodeURIComponent","cName","headers","download","title","formatDate","Date","isEditing","console","debug","getVueScope","jElemPC","height","ctrl","elemPC","elem","cls","Math","random","render","append","className","trim","vueScope","vue","$destroy","Vue","template","el","mounted","stylesheet","styleParent","parentNode","removeChild","parse","methods","onError","err","info","error","keyRows","key","has","indexRows","keys","uniqueKeys","uniq","rowIndex","realIndex","indexOf","cloneDeep","getOptionsToRemember","themeType","config","theme","url","encode","value","decode","decodeURIComponent","toParams","objValues","opt_prefixVar","Object","entries","arrParams","join","getTimeValues","opt_name","result","time","timeSrv","from","to","getTimeParams","getVarValues","opt_filter","opt_negate","arrFilter","some","filter","RegExp","test","templateSrv","variables","values","variable","name","varValues","current","isAll","includeAll","getVarParams","dataList","colNames","c","reduceRight","cell","cellIndex","updateView","scope","attrs","element","MetricsPanelCtrl","errorHandler","vm","templateUrl"],"mappings":"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","sourcesContent":["import {MetricsPanelCtrl} from 'app/plugins/sdk';\nimport _ from 'lodash';\nimport * as JS from './external/YourJS.min';\nimport { pseudoCssToJSON, toCSV, tableToArray } from './helper-functions';\nimport * as Vue from './external/vue.min';\nimport config from 'app/core/config';\n\nconst SEL_DISABLE_DOWNLOAD_CSV = '<llow-csv><ble-csv><llow-download><ble-download>'.replace(/<(.+?)>/g, ':not([data-disa$1])');\n\nconst DEFAULT_PANEL_SETTINGS = {\n  html: '<h2>Output of available datasets:</h2>\\n<div><pre>{{ JSON.stringify(dataset, null, 2) }}</pre></div>',\n  css: '& {\\n  overflow: auto;\\n}',\n  canDownloadDatasets: true,\n  emIsContentHeight: false\n};\n\nfunction normalizeHasher(hasher) {\n  let hasherType = typeof hasher;\n  return 'function' === hasherType\n    ? hasher\n    : 'string' === hasherType\n      ? row => JSON.stringify(row[hasher])\n      : row => JSON.stringify(hasher.map(item => row[item]));\n}\n\nexport class VueHtmlPanelCtrl extends MetricsPanelCtrl {\n  constructor($scope, $injector, $rootScope) {\n    super($scope, $injector);\n\n    this.$rootScope = $rootScope;\n\n    _.defaultsDeep(this.panel, DEFAULT_PANEL_SETTINGS);\n\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n    this.events.on('data-received', this.onDataReceived.bind(this));\n    this.events.on('data-snapshot-load', this.onDataReceived.bind(this));\n    this.events.on('view-mode-changed', this.onViewModeChanged.bind(this));\n    this.events.on('init-panel-actions', this.onInitPanelActions.bind(this));\n    \n    // Additional events that we can hook into...\n    // this.events.on('component-did-mount', this.onComponentDidMount.bind(this));\n    // this.events.on('data-error', this.onDataError.bind(this));\n    // this.events.on('panel-size-changed', this.onPanelSizeChanged.bind(this));\n    // this.events.on('panel-teardown', this.onPanelTeardown.bind(this));\n    // this.events.on('refresh', this.onRefresh.bind(this));\n    // this.events.on('render', this.onRender.bind(this));\n  }\n\n  /**\n   * Executed when panel actions should be loaded.\n   * @param {*} actions Actions to be added.\n   */\n  onInitPanelActions(actions) {\n    let tablesSubmenu = this.panelElement.find('table').toArray().reduce(\n      (carry, table, index) => {\n        if (jQuery(table).is(SEL_DISABLE_DOWNLOAD_CSV)) {\n          carry.push({\n            text: table.getAttribute('data-title') ? `Export \"${table.getAttribute('data-title')}\" As CSV` : `Export Table #${index + 1} As CSV`,\n            icon: 'fa fa-fw fa-table',\n            click: `ctrl.csvifyTable(${index})`\n          });\n        }\n        return carry;\n      },\n      []\n    );\n    if (tablesSubmenu.length) {\n      actions.push.apply(actions, [{ divider: true, role: 'Editor' }].concat(tablesSubmenu));\n    }\n\n    if (this.panel.canDownloadDatasets) {\n      let datasetsSubmenu = this.dataset.reduce((carry, data, index) => {\n        let raw = data.raw;\n        if (raw.type === 'table' && raw.columns.length) {\n          carry.push({\n            text: `Export Dataset \"${raw.refId}\" As CSV`,\n            icon: 'fa fa-fw fa-database',\n            click: `ctrl.csvifyDataset(${index})`\n          });\n        }\n        return carry;\n      }, []);\n      if (datasetsSubmenu.length) {\n        actions.push.apply(actions, [{ divider: true, role: 'Editor' }].concat(datasetsSubmenu));\n      }\n    }\n  }\n\n  /**\n   * Executed before showing edit mode.\n   */\n  onInitEditMode() {\n    let path = 'public/plugins/westc-vuehtml-panel/partials/';\n    this.addEditorTab('Editor', `${path}editor.html`, 1);\n  }\n\n  /**\n   * Executed when the view mode of the panel changes between edit and view.\n   */\n  onViewModeChanged() {\n    this.logVueScope();\n  }\n\n  csvifyDataset(datasetIndex) {\n    let data = this.dataset[datasetIndex];\n    let { columnNames, rows } = data;\n\n    JS.dom({\n      _: 'a',\n      href: 'data:text/csv;charset=utf-8,' + encodeURIComponent(\n        toCSV(\n          rows.map(row => columnNames.map(cName => row[cName])),\n          { headers: columnNames }\n        )\n      ),\n      download: this.panel.title + JS.formatDate(new Date, \" (YYYY-MM-DD 'at' H.mm.ss)\") + `.dataset-${data.raw.refId}.csv`\n    }).click();\n  }\n\n  csvifyTable(index) {\n    let table = this.panelElement.find('table').toArray()[index];\n    let title = table.getAttribute('data-title') || (this.panel.title + ` Table ${index + 1}`);\n\n    JS.dom({\n      _: 'a',\n      href: 'data:text/csv;charset=utf-8,' + encodeURIComponent(toCSV(tableToArray(table))),\n      download: title + JS.formatDate(new Date, \" (YYYY-MM-DD 'at' H.mm.ss)\") + `.csv`\n    }).click();\n  }\n\n  /**\n   * Adds the Vue scope to the console log if in editing mode.\n   */\n  logVueScope() {\n    // If in editing mode show the html scope.\n    if (this.panel.isEditing) {\n      console.debug('Data values available:', this.getVueScope());\n    }\n  }\n\n  render() {\n    // If an `em` unit is supposed to be the height of the panel then\n    // recalculate it.\n    let jElemPC = this.panelElement;\n    jElemPC.css('font-size', this.panel.emIsContentHeight ? jElemPC.height() + 'px' : '');\n  }\n\n  /**\n   * Should only be called when the panel should re-rendered fresh.  Not defined\n   * as render because there is no need to re-render every time the window\n   * resizes or the panel resizes.\n   */\n  updateView() {\n    let ctrl = this;\n    let jElemPC = ctrl.panelElement;\n    let elemPC = jElemPC[0];\n    let elem = JS.dom({ _: 'div' });\n    let panel = ctrl.panel;\n    let cls = ('_' + Math.random()).replace(/0\\./, +new Date);\n\n    this.render(); // Recalculates `em` size if it is supposed to.\n\n    jElemPC.html('').append(elem);\n\n    elemPC.className = elemPC.className.replace(/(^|\\s+)_\\d+(?=\\s+|$)/g, ' ').trim() + ' ' + cls;\n\n    // Data available to the HTML code.\n    let vueScope = ctrl.getVueScope();\n\n    if (ctrl.vue) {\n      ctrl.vue.$destroy();\n    }\n\n    ctrl.vue = new Vue({\n      template: `<div>${panel.html}</div>`,\n      el: elem,\n      data: vueScope,\n      mounted() {\n        // Remove the old stylesheet from the document if it exists.\n        let stylesheet = ctrl.stylesheet;\n        let styleParent = stylesheet && stylesheet.parentNode;\n        if (styleParent) {\n          styleParent.removeChild(stylesheet);\n        }\n\n        // Add the nested CSS to the panel.\n        ctrl.stylesheet = JS.css(JSON.parse(pseudoCssToJSON(panel.css)), '.' + cls);\n      },\n      methods: {\n        onError(err, info) {\n          console.error('VueHtmlPanelCtrl error:', { err, info });\n        },\n        keyRows(rows, hasher) {\n          hasher = normalizeHasher(hasher);\n          return rows.reduce((carry, row) => {\n            let key = hasher(row);\n            carry[key] = _.has(carry, key) ? carry[key].concat([row]) : [row];\n            return carry;\n          }, {});\n        },\n        indexRows(rows, hasher) {\n          hasher = normalizeHasher(hasher);\n          let keys = rows.map(row => hasher(row));\n          let uniqueKeys = _.uniq(keys);\n          return rows.reduce((carry, row, rowIndex) => {\n            let realIndex = uniqueKeys.indexOf(keys[rowIndex]);\n            carry[realIndex] = _.has(carry, realIndex) ? carry[realIndex].concat([row]) : [row];\n            return carry;\n          }, []);\n        }\n      }\n    });\n  }\n\n  /**\n   * Gets the object containing the variables available to the Vue HTML.\n   * @returns {Object}\n   *   The Vue scope that is made available to the Vue HTML.\n   */\n  getVueScope() {\n    let ctrl = this;\n    return _.cloneDeep({\n      dataset: ctrl.dataset,\n      panel: ctrl.panel.getOptionsToRemember(),\n      JS,\n      themeType: config.theme.type,\n      url: {\n        encode(value) {\n          return encodeURIComponent(value + '').replace(/%20/g, '+');\n        },\n        decode(value) {\n          return decodeURIComponent((value + '').replace(/\\+/g, '%20'));\n        },\n        toParams(objValues, opt_prefixVar) {\n          return Object.entries(objValues).reduce((arrParams, [key, value]) => {\n            return arrParams.concat(\n              JS.toArray(value).map(\n                value => this.encode((opt_prefixVar ? 'var-' : '') + key) + '=' + this.encode(value)\n              )\n            );\n          }, []).join('&');\n        },\n        getTimeValues(opt_name) {\n          let result = {};\n          let { time } = ctrl.timeSrv;\n          if (opt_name != 'to') {\n            result.from = time.from;\n          }\n          if (opt_name != 'from') {\n            result.to = time.to;\n          }\n          return result;\n        },\n        getTimeParams(opt_name) {\n          return this.toParams(this.getTimeValues(opt_name));\n        },\n        getVarValues(opt_filter, opt_negate) {\n          if (opt_filter && 'function' !== typeof opt_filter) {\n            let arrFilter = JS.toArray(opt_filter);\n            opt_filter = key => arrFilter.some(\n              filter => filter instanceof RegExp ? filter.test(key) : (filter == key)\n            );\n          }\n          \n          return ctrl.templateSrv.variables.reduce(\n            (values, variable) => {\n              // At times current.value is a string and at times it is an array.\n              let key = variable.name;\n              let varValues = JS.toArray(variable.current.value);\n              let isAll = variable.includeAll && varValues.length === 1 && varValues[0] === '$__all';\n              varValues = isAll ? [variable.current.text] : varValues;\n              if (opt_filter) {\n                varValues = varValues.filter(value => !!opt_filter(key, value) === !opt_negate);\n              }\n              if (varValues.length) {\n                values[key] = varValues;\n              }\n              return values;\n            },\n            {}\n          );\n        },\n        getVarParams(opt_filter, opt_negate) {\n          return this.toParams(this.getVarValues(opt_filter, opt_negate), true);\n        }\n      }\n    });\n  }\n\n  /**\n   * Executed whenever data is received from the database for this panel.\n   * @param {Array} dataList \n   *   An array of objects containing the data that is collected from the\n   *   database.\n   */\n  onDataReceived(dataList) {\n    if (dataList && dataList.length) {\n      this.dataset = dataList.map(data => {\n        let colNames = data.columns.map(c => 'string' === typeof c ? c : c.text);\n        return {\n          columnNames: colNames,\n          rows: data.rows.map(row => {\n            return row.reduceRight((carry, cell, cellIndex) => {\n              carry[colNames[cellIndex]] = cell;\n              return carry;\n            }, {});\n          }),\n          raw: data\n        };\n      });\n    }\n    else {\n      this.dataset = [];\n    }\n\n    this.updateView();\n    this.logVueScope();\n  }\n\n  link(scope, elem, attrs, ctrl) {\n    this.element = elem;\n    this.panelElement = elem.find('.panel-content');\n  }\n}\n\n// Allows for error handling in vueToHTML().\nVue.config.errorHandler = (err, vm, info) => {\n  if (vm && vm.onError) {\n    vm.onError(err, info);\n  }\n};\n\nVueHtmlPanelCtrl.templateUrl = 'partials/module.html';\n"],"file":"ctrl.js"}